(this["webpackJsonpdwitter-app"]=this["webpackJsonpdwitter-app"]||[]).push([[0],{48:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(40),u=n.n(a),s=(n(48),n(5)),o=n(0),i=Object(r.memo)((function(e){var t=e.username,n=e.onLogout,r=e.onMyTweets,c=e.onAllTweets;return Object(o.jsxs)("header",{className:"header",children:[Object(o.jsxs)("div",{className:"logo",children:[Object(o.jsx)("img",{src:"./img/logo.png",alt:"Dwitter Logo",className:"logo-img"}),Object(o.jsx)("h1",{className:"logo-name",children:"Dwitter"}),t&&Object(o.jsxs)("span",{className:"logo-user",children:["@",t]})]}),t&&Object(o.jsxs)("nav",{className:"menu",children:[Object(o.jsx)("button",{onClick:c,children:"All Tweets"}),Object(o.jsx)("button",{onClick:r,children:"My Tweets"}),Object(o.jsx)("button",{className:"menu-item",onClick:n,children:"Logout"})]})]})})),j=n(37),l=n(7),b=Object(r.memo)((function(e){var t=e.text,n=e.isAlert;return Object(o.jsx)(o.Fragment,{children:t&&Object(o.jsx)("p",{className:"banner ".concat(n?"banner-red":"banner-green"),children:t})})})),h=n(2),f=n(6),p=function(e){var t=e.tweetService,n=e.onError,c=Object(r.useState)(""),a=Object(l.a)(c,2),u=a[0],s=a[1],i=function(){var e=Object(f.a)(Object(h.a)().mark((function e(r){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.preventDefault(),t.postTweet(u).then((function(e){s("")})).catch(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(o.jsxs)("form",{className:"tweet-form",onSubmit:i,children:[Object(o.jsx)("input",{type:"text",placeholder:"Edit your tweet",value:u,required:!0,autoFocus:!0,onChange:function(e){s(e.target.value)},className:"form-input tweet-input"}),Object(o.jsx)("button",{type:"submit",className:"form-btn",children:"Post"})]})};function O(e){var t=new Date(Date.parse(e)),n=new Date,r=Math.floor((n-t)/1e3);if(r<=1)return"just now";if(r<20)return r+" seconds ago";if(r<40)return"half a minute ago";if(r<60)return"less than a minute ago";if(r<=90)return"one minute ago";if(r<=3540)return Math.round(r/60)+" minutes ago";if(r<=5400)return"1 hour ago";if(r<=86400)return Math.round(r/3600)+" hours ago";if(r<=129600)return"1 day ago";if(r<604800)return Math.round(r/86400)+" days ago";if(r<=777600)return"1 week ago";var c=t.toLocaleDateString("default",{month:"long"});return"on ".concat(c," ").concat(t.getDate())}var m=Object(r.memo)((function(e){var t=e.url,n=e.name;return Object(o.jsx)("div",{children:t?Object(o.jsx)("img",{src:t,alt:"avatar",className:"avatar-img"}):Object(o.jsx)("div",{className:"avatar-txt",children:n.charAt(0)})})})),d=function(e){var t=e.tweet,n=e.onUpdate,c=e.onClose,a=Object(r.useState)(t.text),u=Object(l.a)(a,2),s=u[0],i=u[1],j=function(){var e=Object(f.a)(Object(h.a)().mark((function e(r){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.preventDefault(),n(t.id,s),c();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(o.jsxs)("form",{className:"edit-tweet-form",onSubmit:j,children:[Object(o.jsx)("input",{type:"text",placeholder:"Edit your tweet",value:s,required:!0,autoFocus:!0,onChange:function(e){i(e.target.value)},className:"form-input tweet-input"}),Object(o.jsxs)("div",{className:"edit-tweet-form-action",children:[Object(o.jsx)("button",{type:"submit",className:"form-btn-update",children:"Update"}),Object(o.jsx)("button",{type:"button",className:"form-btn-cancel",onClick:c,children:"Cancel"})]})]})},v=Object(r.memo)((function(e){var t=e.tweet,n=e.owner,c=e.onDelete,a=e.onUpdate,u=e.onUsernameClick,s=t.id,i=t.username,j=t.name,b=t.url,h=t.text,f=t.createdAt,p=Object(r.useState)(!1),v=Object(l.a)(p,2),w=v[0],g=v[1];return Object(o.jsxs)("li",{className:"tweet",children:[Object(o.jsxs)("section",{className:"tweet-container",children:[Object(o.jsx)(m,{url:b,name:j}),Object(o.jsxs)("div",{className:"tweet-body",children:[Object(o.jsx)("span",{className:"tweet-name",children:j}),Object(o.jsxs)("span",{className:"tweet-username",onClick:function(){return u(t)},children:["@",i]}),Object(o.jsxs)("span",{className:"tweet-date",children:[" \xb7 ",O(f)]}),Object(o.jsx)("p",{children:h}),w&&Object(o.jsx)(d,{tweet:t,onUpdate:a,onClose:function(){return g(!1)}})]})]}),n&&Object(o.jsxs)("div",{className:"tweet-action",children:[Object(o.jsx)("button",{className:"tweet-action-btn",onClick:function(){return c(s)},children:"x"}),Object(o.jsx)("button",{className:"tweet-action-btn",onClick:function(){return g(!0)},children:"\u270e"})]})]})})),w=n(3),g=n(4),x=function(e){var t=e.onSignUp,n=e.onLogin,c=Object(r.useState)(!1),a=Object(l.a)(c,2),u=a[0],s=a[1],i=Object(r.useState)(""),j=Object(l.a)(i,2),h=j[0],f=j[1],p=Object(r.useState)(""),O=Object(l.a)(p,2),m=O[0],d=O[1],v=Object(r.useState)(""),w=Object(l.a)(v,2),g=w[0],x=w[1],k=Object(r.useState)(""),y=Object(l.a)(k,2),S=y[0],N=y[1],T=Object(r.useState)(""),C=Object(l.a)(T,2),E=C[0],U=C[1],D=Object(r.useState)(""),L=Object(l.a)(D,2),A=L[0],M=L[1],I=Object(r.useState)(!1),P=Object(l.a)(I,2),F=P[0],H=P[1],J=function(e){M(e.toString()),H(!0)},q=function(e){var t=e.target,n=t.name,r=t.value,c=t.checked;switch(n){case"username":return f(r);case"password":return d(r);case"name":return x(r);case"email":return N(r);case"url":return U(r);case"signup":return s(c)}};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(b,{text:A,isAlert:F}),Object(o.jsxs)("form",{className:"auth-form",onSubmit:function(e){e.preventDefault(),u?t(h,m,g,S,E).catch(J):n(h,m).catch(J)},children:[Object(o.jsx)("input",{name:"username",type:"text",placeholder:"Id",value:h,onChange:q,className:"form-input",required:!0}),Object(o.jsx)("input",{name:"password",type:"password",placeholder:"Password",value:m,className:"form-input",onChange:q}),u&&Object(o.jsx)("input",{name:"name",type:"text",placeholder:"Name",value:g,onChange:q,className:"form-input",required:!0}),u&&Object(o.jsx)("input",{name:"email",type:"email",placeholder:"Email",value:S,onChange:q,className:"form-input",required:!0}),u&&Object(o.jsx)("input",{name:"url",type:"url",placeholder:"Profile Image URL",value:E,onChange:q,className:"form-input"}),Object(o.jsxs)("div",{className:"form-signup",children:[Object(o.jsx)("input",{name:"signup",id:"signup",type:"checkbox",onChange:q,checked:u}),Object(o.jsx)("label",{htmlFor:"signup",children:" Create a new account?"})]}),Object(o.jsx)("button",{className:"form-btn auth-form-btn",type:"submit",children:u?"Sign Up":"Sign In"})]})]})},k=Object(r.createContext)({}),y=Object(r.createRef)();function S(e){var t=e.authService,n=e.authErrorEventBus,c=e.children,a=Object(r.useState)(void 0),u=Object(l.a)(a,2),s=u[0],j=u[1];Object(r.useImperativeHandle)(y,(function(){return s?s.token:void 0})),Object(r.useEffect)((function(){n.listen((function(e){console.log(e),j(void 0)}))}),[n]),Object(r.useEffect)((function(){t.me().then(j).catch(console.error)}),[t]);var b=Object(r.useCallback)(function(){var e=Object(f.a)(Object(h.a)().mark((function e(n,r,c,a,u){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.signup(n,r,c,a,u).then((function(e){return j(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,c,a){return e.apply(this,arguments)}}(),[t]),p=Object(r.useCallback)(function(){var e=Object(f.a)(Object(h.a)().mark((function e(n,r){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.login(n,r).then((function(e){return j(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[t]),O=Object(r.useCallback)(Object(f.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.logout().then((function(){return j(void 0)})));case 1:case"end":return e.stop()}}),e)}))),[t]),m=Object(r.useMemo)((function(){return{user:s,signUp:b,logIn:p,logout:O}}),[s,b,p,O]);return Object(o.jsx)(k.Provider,{value:m,children:s?c:Object(o.jsxs)("div",{className:"app",children:[Object(o.jsx)(i,{}),Object(o.jsx)(x,{onSignUp:b,onLogin:p})]})})}var N=function(){function e(){Object(w.a)(this,e)}return Object(g.a)(e,[{key:"listen",value:function(e){this.callback=e}},{key:"notify",value:function(e){this.callback(e)}}]),e}(),T=function(){return Object(r.useContext)(k)},C=Object(r.memo)((function(e){var t=e.tweetService,n=e.username,c=e.addable,a=Object(r.useState)([]),u=Object(l.a)(a,2),i=u[0],h=u[1],f=Object(r.useState)(""),O=Object(l.a)(f,2),m=O[0],d=O[1],w=Object(s.f)(),g=T().user;Object(r.useEffect)((function(){t.getTweets(n).then((function(e){return h(Object(j.a)(e))})).catch(N);var e=t.onSync((function(e){return x(e)}));return function(){return e()}}),[t,n,g]);var x=function(e){h((function(t){return[e].concat(Object(j.a)(t))}))},k=function(e){return t.deleteTweet(e).then((function(){return h((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(e){return d(e.toString())}))},y=function(e,n){return t.updateTweet(e,n).then((function(e){return h((function(t){return t.map((function(t){return t.id===e.id?e:t}))}))})).catch((function(e){return e.toString()}))},S=function(e){return w.push("/".concat(e.username))},N=function(e){d(e.toString()),setTimeout((function(){d("")}),3e3)};return Object(o.jsxs)(o.Fragment,{children:[c&&Object(o.jsx)(p,{tweetService:t,onError:N}),m&&Object(o.jsx)(b,{text:m,isAlert:!0,transient:!0}),0===i.length&&Object(o.jsx)("p",{className:"tweets-empty",children:"No Tweets Yet"}),Object(o.jsx)("ul",{className:"tweets",children:i.map((function(e){return Object(o.jsx)(v,{tweet:e,owner:e.username===g.username,onDelete:k,onUpdate:y,onUsernameClick:S},e.id)}))})]})})),E=function(e){var t=e.tweetService;return Object(o.jsx)(C,{tweetService:t,addable:!0})},U=function(e){var t=e.tweetService,n=Object(s.g)().username;return Object(o.jsx)(C,{tweetService:t,username:n,addable:!1})};var D=function(e){var t=e.tweetService,n=Object(s.f)(),r=T(),c=r.user,a=r.logout;return Object(o.jsxs)("div",{className:"app",children:[Object(o.jsx)(i,{username:c.username,onLogout:function(){window.confirm("Do you want to log out?")&&(a(),n.push("/"))},onAllTweets:function(){n.push("/")},onMyTweets:function(){n.push("/".concat(c.username))}}),Object(o.jsxs)(s.c,{children:["(",Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(s.a,{exact:!0,path:"/",children:Object(o.jsx)(E,{tweetService:t})}),Object(o.jsx)(s.a,{exact:!0,path:"/:username",children:Object(o.jsx)(U,{tweetService:t})})]}),")"]})]})},L=function(){function e(t,n){Object(w.a)(this,e),this.http=t,this.tokenStorage=n}return Object(g.a)(e,[{key:"signup",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(t,n,r,c,a){var u;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.http.fetch("/auth/signup",{method:"POST",body:JSON.stringify({username:t,password:n,name:r,email:c,url:a})});case 2:return u=e.sent,this.tokenStorage.saveToken(u.token),e.abrupt("return",u);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,c,a){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(t,n){var r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.http.fetch("/auth/login",{method:"POST",body:JSON.stringify({username:t,password:n})});case 2:return r=e.sent,this.tokenStorage.saveToken(r.token),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"me",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(){var t;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tokenStorage.getToken(),e.abrupt("return",this.http.fetch("/auth/me",{method:"GET",headers:{Authorization:"Bearer ".concat(t)}}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.tokenStorage.clearToken();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),A=function(){function e(t,n,r){Object(w.a)(this,e),this.http=t,this.tokenStorage=n,this.socket=r}return Object(g.a)(e,[{key:"getTweets",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(t){var n;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?"?username=".concat(t):"",e.abrupt("return",this.http.fetch("/tweets".concat(n),{method:"GET",headers:this.getHeaders()}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postTweet",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(t){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.http.fetch("/tweets",{method:"POST",headers:this.getHeaders(),body:JSON.stringify({text:t,username:"ellie",name:"Ellie"})}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTweet",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(t){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.http.fetch("/tweets/".concat(t),{method:"DELETE",headers:this.getHeaders()}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateTweet",value:function(){var e=Object(f.a)(Object(h.a)().mark((function e(t,n){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.http.fetch("/tweets/".concat(t),{method:"PUT",headers:this.getHeaders(),body:JSON.stringify({text:n})}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getHeaders",value:function(){var e=this.tokenStorage.getToken();return{Authorization:"Bearer ".concat(e)}}},{key:"onSync",value:function(e){return this.socket.onSync("tweets",e)}}]),e}(),M=n(28),I=n(34),P=function(){function e(t){Object(w.a)(this,e),this.baseURL=t}return Object(g.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(f.a)(Object(h.a)().mark((function e(t,n){var r,c,a;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseURL).concat(t),Object(I.a)(Object(I.a)({},n),{},{headers:Object(I.a)({"Content-Type":"application/json"},n.headers)}));case 2:return r=e.sent,e.prev=3,e.next=6,r.json();case 6:c=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error(e.t0);case 12:if(!(r.status>299||r.status<200)){e.next=15;break}throw a=c&&c.message?c.message:"Something went wrong! \ud83e\udd2a",new Error(a);case 15:return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),F="token",H=function(){function e(){Object(w.a)(this,e)}return Object(g.a)(e,[{key:"saveToken",value:function(e){localStorage.setItem(F,e)}},{key:"getToken",value:function(){return localStorage.getItem(F)}},{key:"clearToken",value:function(){localStorage.clear(F)}}]),e}(),J=n(43),q=function(){function e(t,n){Object(w.a)(this,e),this.io=Object(J.a)(t,{auth:function(e){return e({token:n()})}}),this.io.on("connect_error",(function(e){console.log("socket error",e.message)}))}return Object(g.a)(e,[{key:"onSync",value:function(e,t){var n=this;return this.io.connected||this.io.connect(),this.io.on(e,(function(e){return t(e)})),function(){return n.io.off(e)}}}]),e}(),B="https://dwitter1.herokuapp.com",R=new H,z=new P(B),G=new N,Y=new L(z,R),_=new q(B,(function(){return R.getToken()})),K=new A(z,R,_);u.a.render(Object(o.jsx)(c.a.StrictMode,{children:Object(o.jsx)(M.a,{children:Object(o.jsx)(S,{authService:Y,authErrorEventBus:G,children:Object(o.jsx)(D,{tweetService:K})})})}),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.a8669fa0.chunk.js.map